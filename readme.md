# Mealie Cookbook Generator

I started playing with [Mealie](https://github.com/mealie-recipes/mealie) a while back and have found it to be a great tool. I have since digitized all of our family recipes and wanted a way to share those back with my family in a consistent format (no more magazine clippings and notecards with unreadable handwriting). 

This is a *very* basic script to generate a pdf using data from the Mealie API and isn't supposed to be production level code by any means; however, I was happy with the generated output, so figured if someone else could get value from my work, I'd love to be able to share it. "Someday" I'll modularize it.

# Structure

The script pulls html and css from the `templates` directory, then injects data from the Mealie API to create recipe pages. These HTML pages are then rendered into individual PDF files. It also uses the API data to generate dynamic table of content pages, static reference pages, and an index section to help you find the recipe you're looking for quickly by listing all recipes by name, all recipes by common ingredients, and all recipes by tag. It finally combines all of the pages together to form the final book.

## Output

The script dumps the intermediate HTML files, as well as the rendered PDF files into the `output/` directory. The static pages and the meta pages are at the root directory, and then each category has a subdirectory. The final output of all combined pages written to the top level of the project.

# Usage

## Setup

This script is opinionated in how it assumes you have Mealie set up. First, it assumes that you have recipes divided into categories (with each recipe only belonging to a single category). It also assumes that you have standardized units and ingredients. The use of tags in Mealie is optional, and they can be used to group like things in the index file at the end of the book.

As of this writing, this works against the 1.0.0beta-5 version of Mealie.

## Python

This script is a python3 script and works with python 3.10.6. If you don't already use it, I recommend [pyenv](https://github.com/pyenv/pyenv) to manage python versions. Install the required packages with ```pip3 install -r requirements.txt```.

## Config File

The repo contains a file named `example_config.ini`. You'll need to copy or rename this file to a file named `config.ini` and then fill out fields.

### API Key

The script requires an API token to authenticate against the Mealie API. You can generate an API token from the `user/profile/api-tokens` page. Store the contents of the token in the `api_token` section of the config file.

### Recipe Min and Max for Index

The index page groups recipes by name, ingredient, and tag. To prevent a whole section for every single ingredient - only common ones, the script can filter the ingredients used to create sections with the `min_recipes` and `max_recipes` options. These will specify the minimum and maximum number of recipes that contain a specific ingredient that will be required to create a section in the index. For example, you might not want an index section for salt, because most recipes have it. And you might not want an index section for walnuts if only one of your recipes has walnuts.

## Commands

Run the generator script with python3:

```
python3 ./cookbook_generator.py <arguments>
```

### Arguments

#### Tag

The `--tag` or `-t` flag allows you to limit recipes generated by passing in tags that the recipes must have to be included in the cookbook. If you don't pass in tag, recipes will not be filtered by tag.

```
--tag moms_recipie recipes_i_actually_like
```

#### Categories

The `--categories` or `-c` flag specifies the categories of recipes that should be included in the cookbook AND specifies what order they should appear in. 
```
--categories breakfast lunch dinner dessert
```

Or, if you've got your priorities in order
```
-c dessert breakfast lunch
```

Or, if you're a hobbit
```
-c breakfast second_breakfast elevenses luncheon afternoon_tea dinner supper
```

#### Index Ignore Tags

The `--indexIgnoreTags` or `-i` flag specifies tags that you would not like to be included in the index page.

```
-i mom_hates
```

#### Remove Tags

The `--removeTags` flag will not generate recipes that have the given tag.

```
--removeTags still_needs_proofing
```

#### Static Pages

Add the `--static_pages` flag if you want to include the static content pages in the cookbook.

#### Foods

The `--foods` flag allows you to specify manually the ingredients that you want in the index. These will still be subject to minimum and maximum recipes as defined above.

```
--foods chickpeas
```

#### Food File

The `--foodFile` flag allows you to specify a file with the same purpose as the `--foods` flag. 

```
--foodFile ingredientsForIndex.txt
```

Where `ingredientsForIndex.txt` is

```
mustard
pizza crust
buffalo sauce
apple
...
```

#### Ingredient Dump

The `--ingredientDump` flag will create a text file named `ingredientsForIndex.txt` with every single ingredient in the recipe list. You then can manually curate the contents to curate the index page sections.

#### Recipe Data Polishing

The `--find_title_issues` and `--find_step_issues` flags are standalone utilities that check your mealie data for inconsistencies that look bad in a final cookbook.

`--find_title_issues` checks for an apostrophe in recipe titles. I want Grandma's Muffins recipe to show up under M, not G, so I use this to find any instances of so-and-so's recipe and then add that information to the recipe description and change the title.

`--find_step_issues` checks for a number of things. It looks for steps that contain unspecific oven temperatures (I like using Â°F for consistency). It looks for variations in measurement shorthand (T, Tbsp, etc). It looks for fractions in steps that I like to change to use `<sup>1</sup>&frasl;<sub>2</sub>`. Finally, it checks for steps that don't end in a period.

## Example Usage

1) Organize the recipes in your Mealie instance.
2) Create the config file, and fill out the desired info.
```
mv config_example.ini config.ini
```
3) Get API token and save it to the config file.
4) Find and fix issues with Mealie recipes.
```
python3 ./cookbook_generator.py --find_title_issues
python3 ./cookbook_generator.py --find_step_issues
```
5) Dump ingredients to file and prune. (optional)
```
python3 ./cookbook_generator.py --ingredientDump
```
6) Build and run the command to build the book with all the options you want.
```
python3 ./cookbook_generator.py -c breakfast side quick-bread soup dinner cookies ice-cream dessert sauce seasoning -i proofing-needed --removeTags aunt_barbs --static_pages
```

# Customization

The html template and css files are available in the `templates` directory and can be modified before running the script. 